{
  "hash": "f0f21c710215518da8d2c871457ba9a6",
  "result": {
    "engine": "knitr",
    "markdown": "# Summarizing Data {#sec-chapter}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Types of Data\n\n::: {.columns}\n::: {.column width=\"48%\"}\n**Categorical**\n\nSubdivide things into _groups_\n\n- What type?\n- Which category?\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"48%\"}\n**Numerical**\n\nMeasure things with numbers\n\n- How many?\n- How much?\n:::\n:::\n\n#### Categorical (discrete) variables:\n\n**Nominal**\n\n- Order doesn't matter\n- Differ in \"name\" (nominal) only\n\ne.g. `country` in TB case data:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 4\n#>   country      year  cases population\n#>   <chr>       <dbl>  <dbl>      <dbl>\n#> 1 Afghanistan  1999    745   19987071\n#> 2 Afghanistan  2000   2666   20595360\n#> 3 Brazil       1999  37737  172006362\n#> 4 Brazil       2000  80488  174504898\n#> 5 China        1999 212258 1272915272\n#> 6 China        2000 213766 1280428583\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Ordinal**\n\n- Order matters\n- Distance between units not equal\n\ne.g.: `Placement` 2017 Boston marathon:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 3\n#>   Placement `Official Time` Name            \n#>       <dbl> <time>          <chr>           \n#> 1         1 02:09:37        Kirui, Geoffrey \n#> 2         2 02:09:58        Rupp, Galen     \n#> 3         3 02:10:28        Osako, Suguru   \n#> 4         4 02:12:08        Biwott, Shadrack\n#> 5         5 02:12:35        Chebet, Wilson  \n#> 6         6 02:12:45        Abdirahman, Abdi\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n#### Numerical data:\n\n**Interval**\n\n- Numerical scale with arbitrary starting point\n- No \"0\" point\n- Can't say \"x\" is double \"y\"\n\ne.g.: `temp` in Beaver data\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n#>   day time  temp activ\n#> 1 346  840 36.33     0\n#> 2 346  850 36.34     0\n#> 3 346  900 36.35     0\n#> 4 346  910 36.42     0\n#> 5 346  920 36.55     0\n#> 6 346  930 36.69     0\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Ratio**\n\n- Has a \"0\" point\n- Can be described as percentages\n- Can say \"x\" is double \"y\"\n\ne.g.: `height` & `speed` in wildlife impacts\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 3\n#>   incident_date       height speed\n#>   <dttm>               <dbl> <dbl>\n#> 1 2018-12-31 00:00:00    700   200\n#> 2 2018-12-27 00:00:00    600   145\n#> 3 2018-12-23 00:00:00      0   130\n#> 4 2018-12-22 00:00:00    500   160\n#> 5 2018-12-21 00:00:00    100   150\n#> 6 2018-12-18 00:00:00   4500   250\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n### Key Questions\n\n::: {.columns}\n::: {.column width=\"48%\"}\n**Categorical**\n\n<span style=\"color:blue;\">Does this work? Does the order matter?</span>\n\nYes: Ordinal\n\nNo: Nominal\n:::\n\n::: {.column width=\"4%\"}\n:::\n\n::: {.column width=\"48%\"}\n**Numerical**\n\n<span style=\"color:blue;\">Is there a \"baseline\"?</span>\n\nYes: Ratio\n\nNo: Interval\n:::\n:::\n\n### Variable Encoding\n**Be careful of how variables are encoded!**\n\nWhen numbers are categories\n\n- \"Dummy coding\": e.g., `passedTest` = `1` or `0`)\n- \"North\", \"South\", \"East\", \"West\" = `1`, `2`, `3`, `4`\n\nWhen ratio data are discrete (i.e. counts)\n\n- Number of eggs in a carton, heart beats per minute, etc.\n- Continuous variables measured discretely (e.g. age)\n\n### Time\n\n- As _ordinal_ categories: \"Jan.\", \"Feb.\", \"Mar.\", etc.\n- As _interval_ scale: \"Jan. 1\", \"Jan. 2\", \"Jan. 3\", etc.\n- As _ratio_ scale: \"30 sec\", \"60 sec\", \"70 sec\", etc.\n\n## Summary Measures\n\n**Single variables: <span style=\"color:red;\">Centrality</span> &  <span style=\"color:blue;\">Variability</span>**\n\n**Two variables: <span style=\"color:green;\">Correlation</span>**\n\n### <span style=\"color:red;\">Centrality (a.k.a. The \"Average\" Value)</span>\n\n**A single number representing the _middle_ of a set of numbers]**\n\n**Mean**: $\\frac{\\text{Sum of values}}{\\text{\\# of values}}$\n\n**Median**: \"Middle\" value (50% of data above & below)\n\n***Mean isn't always the \"best\" choice***\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  filter(!is.na(height)) %>%\n  summarise(\n    mean = mean(height),\n    median = median(height)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 1 × 2\n#>    mean median\n#>   <dbl>  <dbl>\n#> 1  984.     50\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\nPercent of data below mean:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"73.9%\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**On average, at what height do planes hit birds?**\n\n<img src=\"figs/wildlife-hist.png\" width=500>\n\nOn average, where do planes hit birds? Saying ~1000 ft is misleading. It's much more likely to be under 100 ft.\n\n### <span style=\"color:blue;\">Variability (\"Spread\")</span>\n\n**Standard deviation**: distribution of values relative to the mean\n$s = \\sqrt{\\frac{\\sum_{i=1}^{N}(x_i - \\bar{x})^2}{N - 1}}$\n\n**Interquartile range (IQR)**: $Q_3 - Q_1$ (middle 50% of data)\n\n**Range**: max - min\n\nExample: Days to ship\n\nComplaints are coming in about orders shipped from warehouse B, so you collect some data:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndaysToShip\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>    order warehouseA warehouseB\n#> 1      1          3          1\n#> 2      2          3          1\n#> 3      3          3          1\n#> 4      4          4          3\n#> 5      5          4          3\n#> 6      6          4          4\n#> 7      7          5          5\n#> 8      8          5          5\n#> 9      9          5          5\n#> 10    10          5          6\n#> 11    11          5          7\n#> 12    12          5         10\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\nHere, **averages** are misleading:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndaysToShip %>%\n  gather(warehouse, days, warehouseA:warehouseB) %>%\n  group_by(warehouse) %>%\n  summarise(\n    mean = mean(days),\n    median = median(days)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 2 × 3\n#>   warehouse   mean median\n#>   <chr>      <dbl>  <dbl>\n#> 1 warehouseA  4.25    4.5\n#> 2 warehouseB  4.25    4.5\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Variability** reveals difference in days to ship:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndaysToShip %>%\n  gather(warehouse, days, warehouseA:warehouseB) %>%\n  group_by(warehouse) %>%\n  summarise(\n    mean = mean(days),\n    median = median(days),\n    range = max(days) - min(days),\n    sd = sd(days)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 2 × 5\n#>   warehouse   mean median range    sd\n#>   <chr>      <dbl>  <dbl> <dbl> <dbl>\n#> 1 warehouseA  4.25    4.5     2 0.866\n#> 2 warehouseB  4.25    4.5     9 2.70\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n<center>\n<img src=\"figs/days-to-ship.png\" width=500>\n</center>\n\n**Interpreting the standard deviation**\n\n$s = \\sqrt{\\frac{\\sum_{i=1}^{N}(x_i - \\bar{x})^2}{N - 1}}$\n\n<center>\n<img src=\"figs/days-to-ship-sd.png\" width=380>\n</center>\n\n<img src=\"images/sd.png\">\n\n**Mean** & **Standard Deviation** are sensitive to outliers\n\n**Outliers**: $Q_1 - 1.5 IQR$ or $Q_3 + 1.5 IQR$\n\n**Extreme values**: $Q_1 - 3 IQR$ or $Q_3 + 3 IQR$\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata1 <- c(3, 3, 4, 5, 5, 6, 6, 7, 8, 9)\n```\n:::\n\n\n\n\n\n\n\n\n\n- Mean: 5.6\n- Standard Deviation: 2.01\n- Median: 5.5\n- IQR: 2.5\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata2 <- c(3, 3, 4, 5, 5, 6, 6, 7, 8, 20)\n```\n:::\n\n\n\n\n\n\n\n\n\n- <span style=\"color:red;\">Mean: 6.7</span>\n- <span style=\"color:red;\">Standard Deviation: 4.95</span>\n- <span style=\"color:blue;\">Median: 5.5</span>\n- <span style=\"color:blue;\">IQR: 2.5</span>\n\nRobust statistics for continuous data (less sensitive to outliers):\n\n<span style=\"color:red;\">Centrality</span>: Use _median_ rather than _mean_\n\n<span style=\"color:blue;\">Variability</span>: Use _IQR_ rather than _standard deviation_\n\n## Summarizing/Visualizing Data by Type\n**\"Visualizing data helps us think\"**\n\nOne great example of the importance of visualizing data would be Anscombe's Quartet. Anscombe's quartet is comprised of the four datasets shown below. Although these four datasets have identical summary statistics, their graphs reveal their varying data points. Similarly, the Datasaurus dataset seems like an ordinary dataset when looking at the summary statistics. However, plotting the dataset reveals a dinosaur. Inspired by the Anscombe's Quartet and Datasaurus datasets, the Datasaurus Dozon has 12 datasets with identical summary statistics and differing imagery in their graphs.\n\n**Anscombe's Quartet**\n\n<img src = \"images/anscombe_data.png\" width = \"500\">\n\n<span class=\"footer-small\">Stephen Few (2009, pg. 6)</span>\n\n<img src=\"figs/anscombe-quartet.png\" width=500>\n\n<span class=\"footer-small\">Stephen Few (2009, pg. 6)</span>\n\n**The Datasaurus and the Datasaurus Dozon**\n\n(More [here](https://www.autodeskresearch.com/publications/samestats))\n\n<img src=\"images/datasaurus.png\" width=500>\n\n### The data _type_ determines how to summarize and visualize it.\n\n<div style=\"display: flex; justify-content: space-between;\">\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <h3><strong>Nominal<br>(Categorical)</strong></h3>\n  <p><strong>Measures:</strong></p>\n  <ul>\n    <li>Frequency counts /<br>Proportions</li>\n  </ul>\n  <br><br><br><br>\n  <p><strong>Charts:</strong></p>\n  <ul>\n    <li>Bars</li>\n  </ul>\n</div>\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <h3><strong>Ordinal<br>(Categorical)</strong></h3>\n  <p><strong>Measures:</strong></p>\n  <ul>\n    <li>Frequency counts /<br>Proportions</li>\n    <li><span style=\"color: red;\">Centrality</span>:<br>Median, Mode</li>\n    <li><span style=\"color: blue;\">Variability</span>: IQR</li>\n  </ul>\n  <br>\n  <p><strong>Charts:</strong></p>\n  <ul>\n    <li>Bars</li>\n  </ul>\n</div>\n\n<div style=\"flex: 1;\">\n  <h3><strong>Numerical<br>(Continuous)</strong></h3>\n  <p><strong>Measures:</strong></p>\n  <ul>\n    <li><span style=\"color: red;\">Centrality</span>:<br>Mean, median</li>\n    <li><span style=\"color: blue;\">Variability</span>: Range, standard deviation, IQR</li>\n  </ul>\n  <br><br>\n  <p><strong>Charts:</strong></p>\n  <ul>\n    <li>Histogram</li>\n    <li>Boxplot</li>\n  </ul>\n</div>\n\n</div>\n\n### Summarizing **Nominal** data\n\n**Summarize**: Counts / percentages\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(operator, sort = TRUE) %>%\n  mutate(p = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 4 × 3\n#>   operator               n     p\n#>   <chr>              <int> <dbl>\n#> 1 SOUTHWEST AIRLINES 17970 0.315\n#> 2 UNITED AIRLINES    15116 0.265\n#> 3 AMERICAN AIRLINES  14887 0.261\n#> 4 DELTA AIR LINES     9005 0.158\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Visualize**: (usually sorted) Bars \n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(operator, sort = TRUE) %>%\n  ggplot() +\n  geom_col(\n    aes(x = n, y = reorder(operator, n)),\n    width = 0.7\n  ) +\n  labs(x = \"Count\", y = \"Operator\")\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-operator-bars-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n### Summarizing **Ordinal** data\n\n**Summarize**: Counts / percentages\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(incident_month, sort = TRUE) %>%\n  mutate(p = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 12 × 3\n#>   incident_month     n      p\n#>            <dbl> <int>  <dbl>\n#> 1              9  7980 0.140 \n#> 2             10  7754 0.136 \n#> 3              8  7104 0.125 \n#> 4              5  6161 0.108 \n#> 5              7  6133 0.108 \n#> 6              6  4541 0.0797\n#> # ℹ 6 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Visualize**: Bars\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(incident_month, sort = TRUE) %>%\n  ggplot() +\n  geom_col(\n    aes(x = as.factor(incident_month), y = n),\n    width = 0.7\n  ) +\n  labs(x = \"Incident month\")\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-months-bar-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n### Summarizing **Numerical (continuous)** variables\n\n<div style=\"display: flex; justify-content: space-between;\">\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <strong>Histograms:</strong>\n  <ul>\n    <li>Skewness</li>\n    <li>Number of modes</li>\n  </ul>\n</div>\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <strong>Boxplots:</strong>\n  <ul>\n    <li>Outliers</li>\n    <li>Comparing variables</li>\n  </ul>\n</div>\n\n</div>\n\n<img src = 'images/eda-boxplot.png' width = 700>\n\n#### **Histogram**: Identify Skewness & # of Modes\n\n**Summarise**: Mean, median, sd, range, & IQR:\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(wildlife_impacts$height)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#>     0.0     0.0    50.0   983.8  1000.0 25000.0   18038\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Visualize**: Histogram (identify skewness & modes)\n\n**Height**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_histogram(aes(x = height), bins = 50) +\n  labs(x = 'Height (ft)', y = 'Count')\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-height-hist-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Speed**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_histogram(aes(x = speed), bins = 50) +\n  labs(x = 'speed (mph)', y = 'Count')\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-speed-hist-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n#### **Boxplot**: Identify outliers\n\n**Height**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_boxplot(aes(x = height)) +\n  labs(x = 'Height (ft)', y = NULL)\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-height-boxplot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Speed**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_boxplot(aes(x = speed)) +\n  labs(x = 'Speed (mph)', y = NULL)\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-speed-boxplot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Visualizing Variation\n\nAsk yourself:\n\n- What type of **variation** occurs within my variables?\n- What type of **covariation** occurs between my variables?\n\nCheck out [these guides](https://eda.seas.gwu.edu/2023-Fall/references.html#choosing-the-right-chart)\n\n<center>\n<img src = \"images/plots-table.png\" width = \"500\">\n</center>\n\n### Two **Categorical** Variables\n\nSummarize with a table of counts\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(operator, time_of_day)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 20 × 3\n#>   operator          time_of_day     n\n#>   <chr>             <chr>       <int>\n#> 1 AMERICAN AIRLINES Dawn          458\n#> 2 AMERICAN AIRLINES Day          7809\n#> 3 AMERICAN AIRLINES Dusk          584\n#> 4 AMERICAN AIRLINES Night        3710\n#> 5 AMERICAN AIRLINES <NA>         2326\n#> 6 DELTA AIR LINES   Dawn          267\n#> # ℹ 14 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\nConvert to \"wide\" format with `pivot_wider()` to make it easier to compare values\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(operator, time_of_day) %>%\n  pivot_wider(names_from = time_of_day, values_from = n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 4 × 6\n#>   operator            Dawn   Day  Dusk Night  `NA`\n#>   <chr>              <int> <int> <int> <int> <int>\n#> 1 AMERICAN AIRLINES    458  7809   584  3710  2326\n#> 2 DELTA AIR LINES      267  4846   353  2090  1449\n#> 3 SOUTHWEST AIRLINES   394  9109   599  5425  2443\n#> 4 UNITED AIRLINES      151  3359   181  1510  9915\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\nVisualize with bars:<br>map **fill** to denote 2nd categorical var\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwildlife_impacts %>%\n  count(operator, time_of_day) %>%\n  ggplot() +\n  geom_col(\n    aes(\n      x = n,\n      y = reorder(operator, n),\n      fill = reorder(time_of_day, n)\n    ),\n    width = 0.7,\n    position = 'dodge'\n  ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    fill = \"Time of day\",\n    y = \"Airline\"\n  )\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-two-var-bars-1.png){fig-align='center' width=864}\n:::\n:::\n\n\n\n\n\n\n\n\n\nVisualize with scatterplot - looking for _clustering_ and/or _correlational_ relationship\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_point(\n    aes(x = speed, y = height),\n    size = 0.5\n  ) +\n  labs(\n    x = 'Speed (mph)',\n    y = 'Height (f)'\n  )\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-scatterplot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n### One **Continuous**, One **Categorical**\n\nVisualize with **boxplot**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(wildlife_impacts) +\n  geom_boxplot(aes(x = speed, y = operator)) +\n  labs(\n    x = 'Speed (mph)',\n    y = 'Airline'\n  )\n```\n\n::: {.cell-output-display}\n![](figs/wildlife-two-var-boxplot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Correlation\n\nThere are some pretty racist origins in [eugenics](https://en.wikipedia.org/wiki/Eugenics). This included the notion of being 'well born' and possessing 'superior' genetics, frequently associated with race. The beautiful irony is that human genetics was also the field that conclusively demonstrated the biological falsity of race. It also advanced our understanding of correlation with the works of these two people:\n\n**[Sir Francis Galton](https://en.wikipedia.org/wiki/Francis_Galton) (1822 - 1911)**\n\n- Charles Darwin's cousin.\n- \"Father\" of [eugenics](https://en.wikipedia.org/wiki/Eugenics).\n- Interested in heredity.\n\n<img src=\"images/Francis_Galton_1850s.jpg\" width=400>\n\n**[Karl Pearson](https://en.wikipedia.org/wiki/Karl_Pearson) (1857 - 1936)**\n\n- Galton's ([hero-worshiping](https://en.wikipedia.org/wiki/Apotheosis)) protégé.\n- Defined correlation equation.\n- \"Father\" of mathematical statistics.\n\n<img src=\"images/Karl_Pearson.jpg\" width=400>\n\n**Galton's family data**\n\nGalton, F. (1886). [\"Regression towards mediocrity in hereditary stature\"](http://www.stat.ucla.edu/~nchristo/statistics100C/history_regression.pdf). _The Journal of the Anthropological Institute of Great Britain and Ireland_ 15: 246-263.\n\n**Galton's question**: Does marriage selection indicate a relationship between the heights of husbands and wives?<br>(He called this \"assortative mating\")\n\n\"midparent height\" is just a scaled mean:\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmidparentHeight = (father + 1.08 * mother) / 2\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(HistData)\n\ngaltonScatterplot <- GaltonFamilies %>%\n  ggplot() +\n  geom_point(\n    aes(x = midparentHeight, y = childHeight),\n    size = 0.5,\n    alpha = 0.7\n  ) +\n  theme_classic() +\n  labs(\n    x = 'Midparent height (inches)',\n    y = 'Child height (inches)'\n  )\n\ngaltonScatterplot\n```\n\n::: {.cell-output-display}\n![](figs/galton-scatterplot-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n \n### How do you measure correlation? (**Pearson**)\n\nPearson came up with this:\n\n##### $r = \\frac{\\text{Cov}(x, y)}{\\text{sd}(x) * \\text{sd}(y)}$\n\nAssumptions: <br/>\n1. Variables must be interval or ratio <br/>\n2. Linear relationship <br/>\n\n<div style=\"display: flex; justify-content: space-between;\">\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <img src=\"figs/cor_vstrong_p.png\" width=250>\n</div>\n\n<div style=\"flex: 1; margin-right: 10px;\">\n  <img src=\"figs/cor_quad.png\" width=250>\n</div>\n\n</div>\n\n### How do you _interpret_ $r$?\n\n##### $r = \\frac{\\text{Cov}(x, y)}{\\text{sd}(x) * \\text{sd}(y)}$\n\nInterpretation:\n- $-1 \\le r \\le 1$\n- Closer to 1 is stronger correlation\n- Closer to 0 is weaker correlation\n\n`\n``\n{\n  r\n}\ncor(\n  x = GaltonFamilies$midparentHeight,\n  y = GaltonFamilies$childHeight,\n  method = 'pearson'\n)\n```\n\n<img src=\"figs/galtonScatterplot.png\" width=500>\n\n### What does $r$ mean?\n\n- $\\pm 0.1 - 0.3$: Weak\n- $\\pm 0.3 - 0.5$: Moderate\n- $\\pm 0.5 - 0.8$: Strong\n- $\\pm 0.8 - 1.0$: Very strong\n\n<img src=\"figs/cor_p.png\" width=500>\n\nTest your understanding of $r$ here:\n[guessthecorrelation.com](http://guessthecorrelation.com/)\n\n**Coefficient of determination: $r^2$**\nPercent of variance in one variable that is explained by the other variable\n\n<img src=\"images/rsquared_venn.png\" width = 500>\n\n$r$ | $r^2$\n----|------\n0.1 | 0.01\n0.2 | 0.04\n0.3 | 0.09\n0.4 | 0.16\n0.5 | 0.25\n0.6 | 0.36\n0.7 | 0.49\n0.8 | 0.64\n0.9 | 0.81\n1.0 | 1.00\n\n**You should report both $r$ and $r^2$**\nIf correlation between parent and child height is 0.32, then 10% of the variance in the child height is explained by the parent height.\n\n### Correlation != Causation\n\n**X causes Y**\n\n- Training causes improved performance\n\n**Y causes X**\n\n- Good (bad) performance causes people to train harder (less hard).\n\n--\n\n**Z causes both X & Y**\n\n- Commitment and motivation cause increased training and better performance.\n\n**Be weary of dual axes!**\n\n([They can cause spurious correlations](https://www.tylervigen.com/spurious-correlations))\n\nDual Axes:\n<img src=\"images/hbr_two_axes1.png\" width=500>\n</center>\n\nSingle Axis:\n<img src=\"images/hbr_two_axes2.png\" width=500>\n\n### Outliers\n\n<center>\n<img src = \"images/outliers.jpeg\" width = \"500\">\n</center>\n\n**Pearson** correlation is highly sensitive to outliers\n\n<img src=\"figs/pearson_grid.png\" width=500>\n\n### **Spearman**'s rank-order correlation\n\n#### $r = \\frac{\\text{Cov}(x, y)}{\\text{sd}(x) * \\text{sd}(y)}$\n\n- Separately rank the values of X & Y.\n- Use Pearson's correlation on the _ranks_ instead of the $x$ & $y$ values.\n\nAssumptions:\n\n- Variables can be ordinal, interval or ratio\n- Relationship must be monotonic (i.e. does not require linearity)\n\n**Spearman correlation more robust to outliers**\n\n<img src=\"figs/spearman_grid.png\" width=500>\n\n### Summary of correlation\n\n- **Pearson's correlation**: Described the strength of a **linear** relationship between two variables that are interval or ratio in nature.\n- **Spearman's rank-order correlation**: Describes the strength of a **monotonic** relationship between two variables that are ordinal, interval, or ratio. **It is more robust to outliers**.\n- The **coefficient of determination** ( $r^2$ ) describes the amount of variance in one variable that is explained by the other variable.\n- **Correlation != Causation**\n\nR command (hint: add `use = \"complete.obs\"` to drop NA values)\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npearson <- cor(x, y, method = \"pearson\", use = \"complete.obs\")\nspearman <- cor(x, y, method = \"spearman\", use = \"complete.obs\")\n```\n:::\n\n### **Scatterplots**: The correlation workhorse\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nscatterplot <- mtcars %>%\n  ggplot() +\n  geom_point(\n    aes(x = mpg, y = hp),\n    size = 2,\n    alpha = 0.7\n  ) +\n  theme_classic(base_size = 20) +\n  labs(\n    x = 'Fuel economy (mpg)',\n    y = 'Engine power (hp)'\n  )\n\nscatterplot\n```\n:::\n\n\n\n\n\n\n\n\n\n<center>\n<img src=\"figs/mtcarsScatterplotBase.png\" width=500>\n</center>\n\n### Adding a correlation label to a chart\n\nMake the correlation label\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncorr <- cor(mtcars$mpg, mtcars$hp, method = 'pearson')\n\ncorrLabel <- paste('r = ', round(corr, 2))\n```\n:::\n\n\n\n\n\n\n\n\n\nAdd label to the chart with `annotate()`\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nscatterplot +\n  annotate(\n    geom = 'text',\n    x = 25,\n    y = 310,\n    label = corrLabel,\n    hjust = 0,\n    size = 7\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/mtcarsScatterplot.png\" width=500>\n\n### Visualize all the correlations: `ggcorr()`\n\n<center>\n<img src=\"images/all-the-correlations.jpeg\" width=500>\n</center>\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary('GGally')\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmtcars %>%\n  ggcorr()\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/ggcor_mtcars.png\" width=500>\n</center>\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary('GGally')\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmtcars %>%\n  ggcorr(\n    label = TRUE,\n    label_size = 3,\n    label_round = 2\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/ggcor_mtcars_labels.png\" width=500>\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggcor_mtcars_final <- mtcars %>%\n  ggcorr(\n    label = TRUE,\n    label_size = 3,\n    label_round = 2,\n    label_color = 'white',\n    nbreaks = 5,\n    palette = \"RdBu\"\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/ggcor_mtcars_final.png\" width=500>\n\n**Pearson**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmtcars %>%\n  ggcorr(\n    label = TRUE,\n    label_size = 3,\n    label_round = 2,\n    method = c(\"pairwise\", \"pearson\")\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/ggcor_mtcars_pearson.png\" width=500>\n\n**Spearman**\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmtcars %>%\n  ggcorr(\n    label = TRUE,\n    label_size = 3,\n    label_round = 2,\n    method = c(\"pairwise\", \"spearman\")\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\n<img src=\"figs/ggcor_mtcars_spearman.png\" width=500>\n\n### Correlograms: `ggpairs()`\n\n\n\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary('GGally')\n`\n`\n`\n`\n``\n{\n  r\n}\n#| eval: false\n\nmtcars %>%\n  select(mpg, cyl, disp, hp, wt) %>%\n  ggpairs()\n```\n:::\n\n\n\n\n\n\n\n\n\n- Look for linear relationships\n- View distribution of each variable\n\n<img src=\"figs/ggpairs_mtcars.png\" width=500>\n\n### **Simpson's Paradox**: when correlation betrays you\n\nAt first glance, it seems that body mass and bill depth are negatively correlated. However, if we measure the correlation by species, we find that body mass and bill depth are positively correlated.\n\n**Body mass vs. Bill depth**\n\n<img src=\"figs/simpson_penguins.png\" width=500>\n\n**Body mass vs. Bill depth**\n\n<img src=\"figs/simpson_penguins_good.png\" width=500>\n",
    "supporting": [
      "summarizing-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}